{
  "comments": [
    {
      "key": {
        "uuid": "a398f6d6_15350b2d",
        "filename": "roles/bazelisk-build/tasks/main.yaml",
        "patchSetId": 6
      },
      "lineNbr": 5,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2020-02-15T13:06:19Z",
      "side": 1,
      "message": "Why hard code this? Han-Wen may know better, but we should probably use Google\u0027s Remote Build Execution (RBE), as documented in Documentation/dav-bazel.txt. That would mean to call it something like:\n\n  bazel build --config\u003dremote --remote_instance_name\u003dprojects/{{gerrit_code_review_project_id}}/instances/default_instance\n\nwhere {{gerrit_code_review_project_id}} would be a secret and should be retrieved during execution from the system.",
      "range": {
        "startLine": 5,
        "startChar": 36,
        "endLine": 5,
        "endChar": 93
      },
      "revId": "b4a77e64dc9b40409ed025ece6f897811a3eb64c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "96587d1c_7cd90bfe",
        "filename": "roles/bazelisk-build/tasks/main.yaml",
        "patchSetId": 6
      },
      "lineNbr": 5,
      "author": {
        "id": 1087826
      },
      "writtenOn": "2020-02-17T18:56:32Z",
      "side": 1,
      "message": "This is what the current CI script I based this on does.  My priority was getting something that worked at parity.",
      "parentUuid": "a398f6d6_15350b2d",
      "range": {
        "startLine": 5,
        "startChar": 36,
        "endLine": 5,
        "endChar": 93
      },
      "revId": "b4a77e64dc9b40409ed025ece6f897811a3eb64c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b99b5654_221964b7",
        "filename": "roles/bazelisk-build/tasks/main.yaml",
        "patchSetId": 6
      },
      "lineNbr": 5,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2020-02-17T19:05:39Z",
      "side": 1,
      "message": "The current CI is using Docker image with pre warmed Bazel action and repository caches. One step in building docker image for thd CI is building Gerrit and populating caches on stable branches and master. RBE is another alternative that offers remote cache usage and remote execution.",
      "parentUuid": "96587d1c_7cd90bfe",
      "range": {
        "startLine": 5,
        "startChar": 36,
        "endLine": 5,
        "endChar": 93
      },
      "revId": "b4a77e64dc9b40409ed025ece6f897811a3eb64c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6b80651_665eef18",
        "filename": "roles/bazelisk-build/tasks/main.yaml",
        "patchSetId": 6
      },
      "lineNbr": 5,
      "author": {
        "id": 1087826
      },
      "writtenOn": "2020-02-17T21:57:01Z",
      "side": 1,
      "message": "Yes, sorry, I just meant that this is the script I was working from:\n\nhttps://gerrit.googlesource.com/gerrit-ci-scripts/+/refs/heads/master/jenkins/gerrit-bazel-build-plugin.sh#21\n\nSo that\u0027s the command I went with.  I agree that we should look into caching.  Zuul has a number of facilities for this -- we\u0027re currently benefiting from Zuul\u0027s merger cache to limit interactions with Gerrit -- Zuul makes one request to update the internal merger cache when starting jobs, and then pushes that state to all of the nodes used in the job.  We\u0027re currently not using any prepared images, but we could, and if we did, then Zuul would only need to push the deltas onto the workers.  But at the moment, it only takes about 35 seconds to push the gerrit repo and all of the core plugins onto the worker (and most of that is command overhead, not network io).  So we can probably leave that optimization for later.  We can also look into using RBE, but the combination of needing to use a secret and wanting to do so in a repo where anyone can propose changes makes that complex (but not impossible).\n\nWithin the context of a local build, do you think the \"standalone\" arguments are inappropriate, or are they okay?",
      "parentUuid": "b99b5654_221964b7",
      "range": {
        "startLine": 5,
        "startChar": 36,
        "endLine": 5,
        "endChar": 93
      },
      "revId": "b4a77e64dc9b40409ed025ece6f897811a3eb64c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "40346c38_61b61f02",
        "filename": "roles/bazelisk-build/tasks/main.yaml",
        "patchSetId": 6
      },
      "lineNbr": 12,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2020-02-15T13:06:19Z",
      "side": 1,
      "message": "Same as above --config\u003dremote [...]",
      "range": {
        "startLine": 12,
        "startChar": 30,
        "endLine": 12,
        "endChar": 34
      },
      "revId": "b4a77e64dc9b40409ed025ece6f897811a3eb64c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4b1325ad_215a5109",
        "filename": "zuul.d/jobs.yaml",
        "patchSetId": 6
      },
      "lineNbr": 5,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2020-02-15T13:06:19Z",
      "side": 1,
      "message": "Nit: Unrelated here and could be fixed in the change where it was introduced?",
      "range": {
        "startLine": 5,
        "startChar": 28,
        "endLine": 5,
        "endChar": 29
      },
      "revId": "b4a77e64dc9b40409ed025ece6f897811a3eb64c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d1bb52d_f8131562",
        "filename": "zuul.d/jobs.yaml",
        "patchSetId": 6
      },
      "lineNbr": 30,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2020-02-15T05:17:58Z",
      "side": 1,
      "message": "Builds a Gerrit plugin in-tree",
      "range": {
        "startLine": 30,
        "startChar": 6,
        "endLine": 30,
        "endChar": 28
      },
      "revId": "b4a77e64dc9b40409ed025ece6f897811a3eb64c",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}