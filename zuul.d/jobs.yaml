- job:
    name: gerrit-base
    description: |
      Base job for building Gerrit

      This job sets up the common repos which are required for all
      gerrit-related builds (plugins or Gerrit itself).
    pre-run: playbooks/gerrit-base/pre.yaml
    required-projects:
      - gerrit

- job:
    name: gerrit-base
    description: Branch variant to add projects.
    branches:
      - stable/3.1
      - master
    required-projects:
      - jgit

- job:
    name: gerrit-build
    parent: gerrit-base
    description: |
      Build Gerrit

      This job sets up all the repos which are required for a gerrit
      build and runs bazelisk.

      Responds to these variables:

      .. zuul:jobvar:: baselisk_targets

         The bazelisk targets to build.  Defaults to ":release".

      .. zuul:jobvar:: baselisk_test_targets

         The bazelisk targets to test.
    run: playbooks/gerrit/build.yaml
    vars:
      bazelisk_targets: ":release"
      zuul_work_dir: "{{ ansible_user_dir }}/src/gerrit.googlesource.com/gerrit"
    required-projects:
      - plugins/commit-message-length-validator
      - plugins/download-commands
      - plugins/hooks
      - plugins/replication
      - plugins/reviewnotes
      - plugins/singleusergroup

- job:
    name: gerrit-build
    description: Branch variant to add projects.
    branches:
      - stable/2.16
      - stable/3.0
      - stable/3.1
      - master
    required-projects:
      - plugins/codemirror-editor

- job:
    name: gerrit-build
    description: Branch variant to add projects.
    branches:
      - stable/3.0
      - stable/3.1
      - master
    required-projects:
      - plugins/delete-project
      - plugins/gitiles
      - plugins/plugin-manager
      - plugins/webhooks

- job:
    name: gerrit-build
    description: Branch variant to add projects.
    branches:
      - master
    required-projects:
      - polymer-bridges

- job:
    name: gerrit-plugin-build
    parent: gerrit-base
    description: |
      Builds a Gerrit plugin in-tree

      Responds to these variables:

      .. zuul:jobvar:: gerrit_plugin

         The name of the plugin to build.  Defaults to the project
         under test, but can be specified explicitly to build
         cross-repo.

      .. zuul:jobvar:: baselisk_targets

         The bazelisk targets to build.  Defaults to the gerrit_plugin
         specified above.

      .. zuul:jobvar:: baselisk_test_targets

         The bazelisk targets to test.
    run: playbooks/gerrit-plugin/build.yaml
    vars:
      gerrit_plugin: "{{ zuul.project.short_name }}"
      bazelisk_targets: "plugins/{{ gerrit_plugin }}:{{ gerrit_plugin }}"
      zuul_work_dir: "{{ ansible_user_dir }}/src/gerrit.googlesource.com/gerrit"
